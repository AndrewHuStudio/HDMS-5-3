# HDMS 问答系统数据处理流程（参照 MediArch）

## 目标
在 HDMS 中构建“资料驱动问答 + 知识图谱”的数据处理流水线，参考 MediArch 的 **OCR → 向量化入库 → 图谱化入库** 全流程，逐步落地可维护的工程结构。

---

## 阶段 A：OCR（PDF → 结构化文本/图片）
**目标**：把 PDF/扫描件转换成结构化文本与图片，形成可检索与可图谱化的数据基础。

**参考 MediArch 逻辑**
- OCR 引擎：MinerU / TextIn（通过 `mineru_client.py` 做适配）
- 进度与断点：`ocr_progress.json` + `ocr_progress_tracker.py`
- OCR 输出：Markdown / JSON / 可视化 PDF / 图片

**HDMS 规划结构（已预留）**
- 代码模块目录（待实现）：
  - `utils/ocr/`
  - `utils/ingestion/`
- 数据目录（已创建）：
  - 原始资料：`data/documents/`
  - OCR 产物：`data/ocr/`
  - 进度记录：`data/ocr_progress/`
  - 报告输出：`data/reports/`

**关键产物**
- 文档 Markdown：便于后续切块与引用
- OCR 结构化 JSON：用于实体关系抽取与图谱构造
- 图片与布局信息：用于 VLM 识别和图文混合检索

**已实现（最小可用）**
- OCR 执行入口：`utils/ocr/run_ocr.py`
  - 运行示例：`python -m utils.ocr.run_ocr data/documents`
  - 产物目录：`data/ocr/<类别>/<文档名>/<文档名>.md`

---

## 阶段 B：向量化 + 入库（文本 + 图片）
**目标**：将 OCR 结果切块、向量化，写入向量库与文档库，为 RAG 提供检索能力。

**参考 MediArch 逻辑**
- `pipeline.py`：总流程（OCR → 分块 → embedding → Mongo/Milvus）
- `chunking.py`：分块 + 结构化（text/image/table）
- `embedding.py`：embedding 生成与缓存
- `vision_describer.py`：VLM 图片描述
- `mongodb_writer.py`：写文档/切块
- `milvus_writer.py`：写向量索引

**HDMS 规划结构（已预留）**
- 代码模块目录（待实现）：
  - `utils/chunking/`
  - `utils/embedding/`
  - `utils/vision/`
  - `utils/vector_store/`
- 数据目录（已创建）：
  - 切块数据：`data/chunks/`
  - 向量缓存：`data/embeddings/`

---

## 阶段 C：图谱化入库（实体关系抽取）
**目标**：从切块中抽取管控要素、关系与指标属性，构建 Neo4j 知识图谱。

**参考 MediArch 逻辑**
- `build_kg_with_deepseek.py`：抽取入口
- `kg_builder.py`：核心构建器
- `relation_mapping.py`：关系规范化
- `kg_extraction_prompt_v2.md`：抽取 Prompt
- `medical_architecture.json` / `ontology_seed_data.json`：Schema/本体
- `incremental_update.py` / `graph_tools.py`：增量工具
- `clean_existing_graph.py`：图谱清理

**HDMS 规划结构（已预留）**
- 代码模块目录（待实现）：
  - `utils/graph/`
- 数据目录（已创建）：
  - 图谱产物：`data/graph/`

---

## 阶段 D：一键命令入口（批处理）
**目标**：提供“一键 OCR + 向量化 + 图谱构建”的 CLI 入口，便于部署与复现。

**参考 MediArch 逻辑**
- `batch_indexer.py`：批量 OCR + 向量化入库
- `build_kg.py`：图谱构建入库
- `rebuild.py`：全量重建/清库/校验

**HDMS 规划结构（已预留）**
- 代码模块目录（待实现）：
  - `utils/cli/`

---

## 里程碑建议
1) **第 1 阶段**：打通 OCR → Markdown → 简单 RAG（文本）  
2) **第 2 阶段**：图片 VLM 描述 + 图文混合检索  
3) **第 3 阶段**：图谱构建 + 前端图谱联动  
4) **第 4 阶段**：多模态 + 3D 场景联动  

---

## 说明
当前仅完成目录与文档的结构化预留，具体模块将逐步实现并绑定现有数据库与模型服务。  
后续实现过程中，优先遵循“新增模块 → 接入既有面板”流程，降低协作冲突。
