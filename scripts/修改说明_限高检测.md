# 限高检测问题修复说明

## 问题现象
- 前端请求成功（200），但控制台显示 `setback_volumes` 为 `undefined`。
- 结果：红线体块无法渲染，`setbackVolumesCount` 为 0。

## 根因
后端返回结构与当前前端期望不一致：返回体中缺少 `setback_volumes` 字段
（可能被改名为 `setbackVolumes` 或在开发其他功能时被移除）。

## 修改内容

### 1) 前端兼容不同字段名
文件：`apps/frontend/components/height-check-panel-pure.tsx`

- 兼容 `setback_volumes` 和 `setbackVolumes` 两种命名
- 统一转为数组后再写入 state

核心逻辑（示意）：
```
const rawSetbackVolumes = result.setback_volumes ?? result.setbackVolumes ?? [];
const setbackVolumeList = Array.isArray(rawSetbackVolumes) ? rawSetbackVolumes : [];
setSetbackVolumes(setbackVolumeList);
```

### 2) 后端兜底补齐字段
文件：`services/rhino-api/rhino_api/api/height_check.py`

- 若结果中缺少 `setback_volumes`，则：
  - 若存在 `setbackVolumes`，映射过来
  - 否则补空数组

核心逻辑（示意）：
```
if "setback_volumes" not in result:
    if "setbackVolumes" in result:
        result["setback_volumes"] = result["setbackVolumes"]
    else:
        result["setback_volumes"] = []
```

## 使用建议
- 修改后请重启后端（uvicorn）并刷新前端页面。
- 若仍为 0，请检查后端生成 `setback_volumes` 的逻辑是否被改动或裁剪。

